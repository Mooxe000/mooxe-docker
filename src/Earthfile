VERSION 0.6

IMPORT ./Bullseye AS BaseImg
IMPORT ./Bullseye/DEV AS BaseDev

IMPORT ./Rust AS Rust
IMPORT ./Wasmer AS Wasmer

IMPORT ./Deno AS Deno
IMPORT ./Node AS Node

base-image:

  FROM BaseImg+img

  DO Rust+INSTALL
  DO Wasmer+INSTALL
  DO Deno+INSTALL

  DO BaseImg+CLEAN

  RUN set -eux \
  ; rustup --version \
  ; cargo --version \
  ; rustc --version \
  ; deno --version

  SAVE IMAGE --push mooxe/base

dev-image:

  # FROM mooxe/base
  FROM +base-image

  ENV TZ=Asia/Shanghai

  DO BaseDev+APTFAST

  RUN set -eux \
  ; apt-fast install -y git fish zsh \
  ; apt-fast install -y vim neovim

  DO Rust+MIRRORT
  RUN set -eux \
  ; sed -i "s/'ustc'/'tuna'/g" /usr/local/cargo/config.toml
  DO BaseDev+NU
  # DO Rust+MIRRORO
  # RUN set -eux \
  # ; sed -i "s/'tuna'/'ustc'/g" /usr/local/cargo/config.toml

  DO BaseDev+OHMYPOSH

  RUN set -eux \
  ; echo 'eval "$(oh-my-posh --init --shell bash --config $HOME/.poshthemes/ys.omp.json)"' \
      >> $HOME/.bashrc \
  ; echo 'eval "$(oh-my-posh --init --shell zsh --config $HOME/.poshthemes/ys.omp.json)"' \
      >> $HOME/.zshrc \
  ; mkdir -p $HOME/.config/fish \
  ; echo "set fish_greeting ''" \
      >> $HOME/.config/fish/config.fish \
  ; echo 'oh-my-posh --init --shell fish --config $HOME/.poshthemes/ys.omp.json | source' \
      >> $HOME/.config/fish/config.fish

  DO Wasmer+SHELL

  DO BaseImg+CLEAN

  SAVE IMAGE --push mooxe/dev

node-image:

  # FROM mooxe/dev
  FROM +dev-image

  DO Node+INSTALL

  SAVE IMAGE --push mooxe/node
