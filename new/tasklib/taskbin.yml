version: '3'

vars:
  # git_host: github.com
  git_host: download.fastgit.org

  # dl_bin: wget
  # dl_cmd: '{{dl_bin}} -o-'
  dl_bin: curl
  dl_cmd: '{{.dl_bin}} -O'

tasks:

  default:
    cmds:
      - echo 'Hello World from Task!'
    silent: true

  taskbin-clean:
    vars:
      bin: task
    cmds:
      - if [[ ! -z ./resource/{{.bin}} ]]
        ; then
            rm -f ./resource/{{.bin}}
        ; fi

  taskbin:
    deps:
      - taskbin-clean
    vars:
      bin: task
      git_proj: go-{{.bin}}/{{.bin}}
      prefix: https://{{.git_host}}/{{.git_proj}}/releases/download
      version: v3.16.0
      os: linux_amd64
      file: '{{.bin}}_{{.os}}.tar.gz'
      url: '{{.prefix}}/{{.version}}/{{.file}}'
    cmds:
      - mkdir -p ./build
      - cd ./build
        ; {{.dl_cmd}} {{.url}}
        ; tar xvf {{.file}}
      - mv ./build/{{.bin}} ./resource/
      - rm -rf ./build
